<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    
    <changeSet author="konnikov" id="1241589108464-3">
		<preConditions onFail="MARK_RAN">
			<primaryKeyExists tableName="global_property" primaryKeyName="PRIMARY"/>
		</preConditions>
   		<comment>
			Remove "Primary key" constraint from the "property" collumn in the "global_property" table
		</comment>
		<dropPrimaryKey tableName="global_property" constraintName="PRIMARY"/>
    </changeSet>
    
    <changeSet author="konnikov" id="1241589108464-4">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="global_property" columnName="global_property_id"/>
			</not>
		</preConditions>
   		<comment>
			Add the "global_property_id" collumn to the "global_property" table
		</comment>
        <addColumn tableName="global_property">
            <column name="global_property_id" type="INTEGER UNSIGNED"  autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
        </addColumn>
    </changeSet>
    
    <changeSet author="konnikov" id="1241589108464-5">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="global_property" columnName="default_property_value"/>
			</not>
		</preConditions>
   		<comment>
			Add the default_property_value collumn to the "global_property" table
		</comment>
        <addColumn tableName="global_property">
            <column defaultValue="" name="default_property_value" type="MEDIUMTEXT"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="konnikov" id="1241589108464-6">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="global_property" columnName="global_property_type_id"/>
			</not>
		</preConditions>
   		<comment>
			Add the "global_property_type_id" collumn to the "global_property" table and foreign key constraint for it
		</comment>
        <addColumn tableName="global_property">
            <column defaultValue="1" name="global_property_type_id" type="INTEGER UNSIGNED">
                <constraints nullable="false"/>
            </column>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="global_property_type_id"
			baseTableName="global_property"
			constraintName="type_of_global_property"
			referencedColumnNames="global_property_type_id"
			referencedTableName="global_property_type"/>
    </changeSet>
       
</databaseChangeLog>