<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                  http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">
    
    <changeSet author="konnikov" id="1241589108464-1">
		<preConditions onFail="MARK_RAN">
			<primaryKeyExists tableName="global_property" primaryKeyName="PRIMARY"/>
		</preConditions>
   		<comment>
			Remove "Primary key" constraint from the "property" column in the "global_property" table
		</comment>
		<dropPrimaryKey tableName="global_property" constraintName="PRIMARY"/>
    </changeSet>
    
    <changeSet author="konnikov" id="1241589108464-6">
		<preConditions onFail="MARK_RAN">
			<not>
				<columnExists tableName="global_property" columnName="creator"/>
			</not>
		</preConditions>
   		<comment>
			- Add the "global_property_id" column to the "global_property" table and set it as Primary key
			- Add the default_property_value column to the "global_property" table
			- Add the "global_property_type" column to the "global_property" table
			- Add the "default_global_property_type" column to the "global_property" table
			- Add the "creator" column to the "global_property" table
			- Add the "date_created" column to the "global_property" table
			- Add the "voided" column to the "global_property" table
			- Add the "date_voided" column to the "global_property" table
		</comment>
        <addColumn tableName="global_property">
            <column name="global_property_id" type="INTEGER UNSIGNED"  autoIncrement="true">
                <constraints nullable="false" primaryKey="true"/>
            </column>
            <column defaultValue="" name="default_property_value" type="MEDIUMTEXT"/>
            <column defaultValue="java.lang.String" name="global_property_type" type="VARCHAR(255)" >
                <constraints nullable="false"/>
            </column>
            <column defaultValue="java.lang.String" name="default_global_property_type" type="VARCHAR(255)" >
                <constraints nullable="false"/>
            </column>
            <column defaultValue="1" name="creator" type="INTEGER" >
                <constraints nullable="false"/>
            </column>
			<column name="date_created" type="DATETIME"/>
			<column name="voided" type="smallint" defaultValueNumeric="0">
				<constraints nullable="false" />
			</column>
			<column name="date_voided" type="DATETIME"/>
        </addColumn>
    </changeSet>
    
    <changeSet author="konnikov" id="1241589108464-7">
		<preConditions onFail="MARK_RAN">
			<not>
				<foreignKeyConstraintExists foreignKeyName="global_property_creator"/>
			</not>
		</preConditions>
   		<comment>
			Create the foreign key for the "creator" column
		</comment>
		<addForeignKeyConstraint constraintName="global_property_creator"
			baseTableName="global_property" baseColumnNames="creator"
			referencedTableName="users" referencedColumnNames="user_id"
		/>
    </changeSet>
       
</databaseChangeLog>